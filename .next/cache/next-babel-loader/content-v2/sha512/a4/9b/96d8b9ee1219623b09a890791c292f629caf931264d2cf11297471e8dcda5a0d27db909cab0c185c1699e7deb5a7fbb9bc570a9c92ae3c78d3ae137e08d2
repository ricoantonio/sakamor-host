{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/Users/Rico/Desktop/Home/Kalbe app/sakamor-new/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport Link from \"next/link\";\nimport Router, { useRouter } from \"next/router\";\nimport styles from \"../../../styles/pages/WorkVisitDetail.module.css\";\nimport { Stores } from \"../../../store\";\nimport Nav from \"../../../components/Nav\";\nimport Card from \"../../../components/Card\";\nimport Spinner from \"../../../components/Spinner\";\nimport Button from \"../../../components/Button\";\nimport Modal from \"../../../components/Modal\";\nimport Dropdown from \"../../../components/Dropdown\";\nimport { getAllWorkVisit, getKontenWorkVisit, submitWorkVisit } from \"../../../helper\";\nexport default function index() {\n  var _useContext = useContext(Stores),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch,\n      actions = _useContext.actions;\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState([]),\n      workVisit = _useState2[0],\n      setWorkVisit = _useState2[1];\n\n  var _useState3 = useState([]),\n      konten = _useState3[0],\n      setKonten = _useState3[1];\n\n  var _useState4 = useState(true),\n      loadingKonten = _useState4[0],\n      setLoadingKonten = _useState4[1];\n\n  var _useState5 = useState(false),\n      loadingSubmit = _useState5[0],\n      setLoadingSubmit = _useState5[1];\n\n  var router = useRouter();\n  var now = new Date();\n  useEffect(function () {\n    if (router.query.id) {\n      var userData = JSON.parse(localStorage.getItem(\"user\"));\n      getAllWorkVisit(userData).then(function (res) {\n        var result = res.filter(function (val) {\n          return val.idMasterPlan === router.query.id;\n        });\n        setWorkVisit(result);\n        setLoading(false);\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    }\n  }, [router.query.id]);\n  useEffect(function () {\n    getKontenWorkVisit().then(function (res) {\n      setKonten(res);\n      setLoadingKonten(false);\n    })[\"catch\"](function (err) {\n      console.log(err);\n    });\n  }, [dispatch]);\n\n  var renderPenilaian = function renderPenilaian() {\n    var res = konten.map(function (val, index) {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.penilaian_top_container,\n          children: val.namaKonten\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.penilaian_bot_container,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: styles.nilai_container,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: \"Nilai\"\n            }), /*#__PURE__*/_jsx(Dropdown, {\n              options: [\"SELECT\", 1, 2, 3, 4, 5],\n              type: \"NILAI_WORKVISIT\",\n              onChange: function onChange(e) {\n                konten.splice(index, 1, _objectSpread(_objectSpread({}, konten[index]), {}, {\n                  nilai: parseInt(e.target.value)\n                }));\n              }\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: \"Catatan\"\n            }), /*#__PURE__*/_jsx(\"textarea\", {\n              style: {\n                width: \"100%\",\n                height: \"80px\",\n                fontSize: \"12px\",\n                border: \"1px solid #e9ecf2\",\n                borderRadius: \"5px\"\n              },\n              onChange: function onChange(e) {\n                konten.splice(index, 1, _objectSpread(_objectSpread({}, konten[index]), {}, {\n                  catatan: e.target.value\n                }));\n              }\n            })]\n          })]\n        })]\n      });\n    });\n    return res;\n  };\n\n  var onSubmit = function onSubmit() {\n    var dataNilai = konten.filter(function (val) {\n      return val.nilai;\n    });\n\n    if (dataNilai.length === konten.length) {\n      setLoadingSubmit(true);\n      var userData = JSON.parse(localStorage.getItem(\"user\"));\n      var workVisitFocus = workVisit[0];\n      var dataKonten = konten.map(function (val) {\n        return {\n          id: val.id,\n          idActivityWorkVisit: workVisitFocus.idWorkVisit,\n          idMasterKontenWorkVisit: val.id,\n          rating: val.nilai,\n          catatan: val.catatan ? val.catatan : \"\",\n          createdby: userData.username,\n          updatedBy: userData.username,\n          namaKonten: val.namaKonten\n        };\n      });\n      var data = {\n        workVisit: {\n          id: workVisitFocus.idWorkVisit,\n          idMasterPlanWorkVisit: workVisitFocus.idMasterPlan,\n          namaSMR: workVisitFocus.namaSMR,\n          usernameSMR: workVisitFocus.usernameSMR,\n          kodeRayon: workVisitFocus.kodeRayon,\n          rayon: workVisitFocus.rayon,\n          kodeProduk: workVisitFocus.kodeProduk,\n          produkFokus: workVisitFocus.produkFokus,\n          isPenilaian: true,\n          tanggalPenilaian: now.toISOString(),\n          createdBy: userData.username,\n          updatedBy: userData.username\n        },\n        rating: dataKonten\n      };\n    }\n\n    submitWorkVisit(data).then(function (res) {\n      setLoadingSubmit(false);\n      Router.push(\"/\");\n    })[\"catch\"](function (err) {\n      console.log(err);\n    });\n  };\n\n  var renderDetail = function renderDetail() {\n    var data = workVisit[0];\n\n    if (data) {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(Card, {\n          style: {\n            borderRadius: \"5px\",\n            padding: \"16px\"\n          },\n          shadow: true,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: styles.data_container,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: data.namaSMR\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                textAlign: \"right\"\n              },\n              children: /*#__PURE__*/_jsx(\"span\", {\n                className: styles.rayon_container,\n                children: data.kodeRayon\n              })\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            style: {\n              fontSize: \"12px\",\n              fontWeight: \"400\"\n            },\n            children: [\"Produk Fokus:\", \" \", /*#__PURE__*/_jsx(\"span\", {\n              className: styles.produk_fokus_container,\n              children: data.produkFokus\n            })]\n          })]\n        }), renderPenilaian()]\n      });\n    }\n  };\n\n  var render = function render() {\n    if (loading || loadingKonten) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.container,\n          children: [loadingSubmit ? /*#__PURE__*/_jsx(Modal, {\n            children: /*#__PURE__*/_jsx(Spinner, {})\n          }) : null, /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.wrapper,\n            children: [/*#__PURE__*/_jsx(Nav, {\n              title: \"Work Visit\",\n              color: \"white\",\n              action: \"Submit\",\n              backAction: function backAction() {\n                if (confirm(\"Data will be lost if you leave the page, are you sure?\")) {\n                  actions.setDefaultVisitUnplan();\n                  Router.push(\"/work-visit\");\n                }\n              }\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.main,\n              children: renderDetail()\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.bottom_container,\n              children: /*#__PURE__*/_jsx(Button, {\n                onClick: function onClick() {\n                  onSubmit();\n                },\n                text: \"Submit\"\n              })\n            })]\n          })]\n        })\n      });\n    }\n  };\n\n  return render();\n}","map":null,"metadata":{},"sourceType":"module"}