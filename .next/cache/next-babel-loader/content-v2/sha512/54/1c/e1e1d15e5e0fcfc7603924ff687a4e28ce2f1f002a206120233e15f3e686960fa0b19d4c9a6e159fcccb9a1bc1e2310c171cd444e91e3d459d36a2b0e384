{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/Users/Rico/Desktop/Home/Kalbe app/host-sakamor/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"C:/Users/Rico/Desktop/Home/Kalbe app/host-sakamor/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport Router, { useRouter } from \"next/router\";\nimport styles from \"../styles/pages/VisitPlanDetail.module.css\";\nimport { Stores } from \"../store\";\nimport Nav from \"./Nav\";\nimport Spinner from \"./Spinner\";\nimport Modal from \"./Modal\";\nimport Dropdown from \"./Dropdown\";\nimport { getPosm, getPlanId, getInvoiceDataPosm, viewFile, getInvoiceDataPosmUnplan, viewFileUnplan, getInvoiceDataPosmSpreading, viewFileSpreading } from \"../helper\";\nimport Card from \"./Card\";\nexport default function Visibility(_ref) {\n  var type = _ref.type;\n\n  var _useContext = useContext(Stores),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch,\n      actions = _useContext.actions;\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      loadingView = _useState2[0],\n      setLoadingView = _useState2[1];\n\n  var _useState3 = useState([]),\n      posm = _useState3[0],\n      setPosm = _useState3[1];\n\n  var _useState4 = useState([]),\n      posmList = _useState4[0],\n      setPosmList = _useState4[1];\n\n  var _useState5 = useState([]),\n      plan = _useState5[0],\n      setPlan = _useState5[1];\n\n  var _useState6 = useState(false),\n      modal = _useState6[0],\n      setModal = _useState6[1];\n\n  var _useState7 = useState(null),\n      fileFocus = _useState7[0],\n      setFileFocus = _useState7[1];\n\n  var _useState8 = useState(0),\n      dummy = _useState8[0],\n      setDummy = _useState8[1];\n\n  var _useState9 = useState(false),\n      newNOO = _useState9[0],\n      setNewNOO = _useState9[1];\n\n  var _useState10 = useState([{\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }]),\n      vis = _useState10[0],\n      setVis = _useState10[1];\n\n  var router = useRouter();\n  var initialVis = [{\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }, {\n    file: null,\n    type: null\n  }];\n  useEffect(function () {\n    var notEmpty = vis.filter(function (val) {\n      return val.file !== null && val.type !== null;\n    }); // console.log(notEmpty);\n\n    if (notEmpty.length > 0) {\n      window.onbeforeunload = function () {\n        return \"Data will be lost if you leave the page, are you sure?\";\n      };\n    }\n  });\n  useEffect(function () {\n    if (type === \"PLAN\") {\n      if (state.visitPlanReducer.visibility.length > 0) {\n        setVis(_toConsumableArray(state.visitPlanReducer.visibility));\n      }\n    } else if (type === \"UNPLAN\") {\n      if (state.visitUnplanReducer.visibility.length > 0) {\n        setVis(_toConsumableArray(state.visitUnplanReducer.visibility));\n      }\n    } else if (type === \"SPREADING\") {\n      if (state.visitSpreadingReducer.visibility.length > 0) {\n        setVis(_toConsumableArray(state.visitSpreadingReducer.visibility));\n      }\n    }\n  }, [dispatch]);\n  useEffect(function () {\n    if (router.query[\"new\"]) {\n      setNewNOO(true);\n    } else {\n      if (type === \"UNPLAN\") {\n        if (state.visitUnplanReducer.jenisChannel.namaJenisChannel && state.visitUnplanReducer.outlet.namaOutlet) {} else {\n          Router.push(\"/visit/unplan\");\n        }\n      } else if (type === \"SPREADING\") {\n        if (state.visitSpreadingReducer.jenisChannel.namaJenisChannel && state.visitSpreadingReducer.outlet.namaOutlet) {} else {\n          Router.push(\"/visit/spreading?new=true\");\n        }\n      }\n    }\n  }, []);\n  useEffect(function () {\n    if (router.query.id) {\n      if (type === \"PLAN\") {\n        getPlanId(router.query.id).then(function (_ref2) {\n          var samePlan = _ref2.samePlan,\n              data = _ref2.data;\n\n          // console.log(samePlan, data);\n          if (samePlan.length == 0) {\n            Router.push(\"/visit/plan\");\n          } else {\n            setPlan(data);\n            setLoading(false);\n\n            if (!state.visitPlanReducer.checkIn) {\n              actions.setPlanCheckIn(now);\n            }\n          }\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      } else if (type === \"UNPLAN\") {} else if (type === \"SPREADING\") {} else if (type === \"HISTORY_PLAN\") {\n        getInvoiceDataPosm(router.query.id).then(function (data) {\n          setPosmList(data);\n          console.log(data);\n          setLoading(false);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      } else if (type === \"HISTORY_UNPLAN\") {\n        getInvoiceDataPosmUnplan(router.query.id).then(function (data) {\n          setPosmList(data);\n          console.log(data);\n          setLoading(false);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      } else if (type === \"HISTORY_SPREADING\") {\n        getInvoiceDataPosmSpreading(router.query.id).then(function (data) {\n          setPosmList(data);\n          setLoading(false);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      }\n    }\n  }, [router.query.id]);\n  useEffect(function () {\n    getPosm().then(function (data) {\n      setPosm(data);\n      setLoading(false); // console.log(data);\n    })[\"catch\"](function (err) {\n      console.log(err);\n    });\n  }, [dispatch]);\n\n  var onFileFocus = function onFileFocus(val) {\n    setModal(true);\n    setLoadingView(true);\n\n    if (type === \"HISTORY_PLAN\") {\n      viewFile(val.id).then(function (data) {\n        setFileFocus(data);\n        setLoadingView(false);\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    } else if (type === \"HISTORY_UNPLAN\") {\n      viewFileUnplan(val.id).then(function (data) {\n        setFileFocus(data);\n        setLoadingView(false);\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    } else if (type === \"HISTORY_SPREADING\") {\n      viewFileSpreading(val.id).then(function (data) {\n        setFileFocus(data);\n        setLoadingView(false);\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    }\n  };\n\n  var renderInputUpload = function renderInputUpload() {\n    var render = vis.map(function (val, index) {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.visibility_grid,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [\"POSM \", index + 1]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.visibility_dropdown,\n          children: [/*#__PURE__*/_jsx(Dropdown, {\n            options: posm,\n            type: \"POSM\",\n            onChange: function onChange(e) {\n              var data = posm.filter(function (val) {\n                return val.program == e.target.value;\n              });\n              vis.splice(index, 1, _objectSpread(_objectSpread({}, vis[index]), {}, {\n                type: data[0]\n              }));\n              setDummy(dummy + 1);\n            },\n            value: val.type != null ? val.type.program : \"\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            style: {\n              fontSize: \"10px\",\n              color: \"#41867A\",\n              fontWeight: \"500\"\n            },\n            children: val.file != null ? val.file.name : null\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          children: /*#__PURE__*/_jsxs(\"label\", {\n            className: styles.new_button,\n            htmlFor: \"upload\".concat(index),\n            children: [/*#__PURE__*/_jsx(\"img\", {\n              src: \"/camera.svg\",\n              style: {\n                width: \"18px\",\n                verticalAlign: \"baseline\"\n              }\n            }), /*#__PURE__*/_jsx(\"input\", {\n              className: styles.input_file,\n              onChange: function onChange(e) {\n                // let reader = new FileReader();\n                // reader.readAsDataURL(e.target.files[0]);\n                // reader.onload = () => {\n                //   console.log(reader.result);\n                // };\n                vis.splice(index, 1, _objectSpread(_objectSpread({}, vis[index]), {}, {\n                  file: e.target.files[0]\n                }));\n                setDummy(dummy + 1);\n              },\n              id: \"upload\".concat(index),\n              type: \"file\",\n              accept: \"image/*\",\n              capture: \"environment\"\n            })]\n          })\n        })]\n      }, index);\n    });\n    return render;\n  };\n\n  var renderHistoryPosm = function renderHistoryPosm() {\n    var render = posmList.map(function (val, index) {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.visibility_grid_history,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [\"POSM \", index + 1]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.visibility_dropdown,\n          children: [/*#__PURE__*/_jsx(Card, {\n            style: {\n              height: \"32px\",\n              border: \"1px solid #e9ecf2\",\n              padding: \"6px 10px\",\n              borderRadius: \"5px\"\n            },\n            children: val.tipe\n          }), /*#__PURE__*/_jsx(\"span\", {\n            style: {\n              fontSize: \"10px\",\n              color: \"#41867A\",\n              fontWeight: \"500\"\n            },\n            onClick: function onClick() {\n              onFileFocus(val);\n            },\n            children: val.namaFile\n          })]\n        })]\n      }, index);\n    });\n\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return render;\n    }\n  };\n\n  var onSave = function onSave() {\n    if (newNOO) {\n      actions.setSpreadingVisibility(vis);\n      Router.push(\"/visit/spreading/submit?new=true\");\n    } else {\n      if (type === \"PLAN\") {\n        actions.setPlanVisibility(vis);\n        Router.push(\"/visit/plan/\".concat(router.query.id));\n      } else if (type === \"UNPLAN\") {\n        actions.setUnplanVisibility(vis);\n        Router.push(\"/visit/unplan/submit\");\n      } else if (type === \"SPREADING\") {\n        actions.setSpreadingVisibility(vis);\n        Router.push(\"/visit/spreading/submit\");\n      }\n    }\n  }; // const displayView = () => {\n  //   // let reader = new FileReader();\n  //   var objectURL = URL.createObjectURL(fileFocus);\n  //   // myImage.src = objectURL;\n  //   return objectURL;\n  // };\n\n\n  var render = function render() {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.container,\n      children: [modal ? /*#__PURE__*/_jsx(Modal, {\n        onClick: function onClick() {\n          setFileFocus(null);\n          setModal(false);\n        },\n        children: /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            maxHeight: \"100%\",\n            overflow: \"auto\"\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            style: {\n              width: \"400px\",\n              maxHeight: \"100%\",\n              margin: \"20px auto\"\n            },\n            children: loadingView ? /*#__PURE__*/_jsx(Spinner, {}) : /*#__PURE__*/_jsx(\"img\", {\n              style: {\n                width: \"380px\",\n                margin: \"0 10px\"\n              },\n              src: fileFocus\n            })\n          })\n        })\n      }) : null, /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.wrapper,\n        children: [type.includes(\"HISTORY\") ? /*#__PURE__*/_jsx(Nav, {\n          title: \"Visibility\",\n          color: \"white\",\n          backAction: function backAction() {\n            Router.back();\n          }\n        }) : /*#__PURE__*/_jsx(Nav, {\n          title: \"Visibility\",\n          color: \"white\",\n          action: \"Save\",\n          onClick: function onClick() {\n            onSave();\n          },\n          backAction: function backAction() {\n            if (type === \"PLAN\") {\n              if (state.visitPlanReducer.visibility.length > 0) {\n                setVis(_toConsumableArray(state.visitPlanReducer.visibility));\n              } else {\n                setVis([].concat(initialVis));\n              }\n            }\n\n            if (type === \"UNPLAN\") {\n              if (state.visitUnplanReducer.visibility.length > 0) {\n                setVis(_toConsumableArray(state.visitUnplanReducer.visibility));\n              } else {\n                setVis([].concat(initialVis));\n              }\n            }\n\n            if (type === \"SPREADING\") {\n              if (state.visitSpreadingReducer.visibility.length > 0) {\n                setVis(_toConsumableArray(state.visitSpreadingReducer.visibility));\n              } else {\n                setVis([].concat(initialVis));\n              }\n            }\n\n            Router.back();\n          },\n          disable: false\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.main,\n          children: type.includes(\"HISTORY\") ? renderHistoryPosm() : renderInputUpload()\n        })]\n      })]\n    });\n  };\n\n  return render();\n}","map":null,"metadata":{},"sourceType":"module"}