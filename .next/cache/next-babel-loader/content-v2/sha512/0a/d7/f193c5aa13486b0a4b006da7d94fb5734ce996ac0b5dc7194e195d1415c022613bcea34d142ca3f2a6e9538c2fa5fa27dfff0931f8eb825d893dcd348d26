{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport Link from \"next/link\";\nimport Router, { useRouter } from \"next/router\";\nimport styles from \"../styles/pages/VisitPlanDetail.module.css\";\nimport Nav from \"./Nav\";\nimport Card from \"./Card\";\nimport Spinner from \"./Spinner\";\nimport Button from \"./Button\";\nimport html2canvas from \"html2canvas\";\nimport { getInvoiceData, getInvoiceDataPosm, getPlanMonthlyHistory, getInvoiceDataUnplan, getInvoiceDataPosmUnplan, getUnplanMonthlyHistory, getSpreadingMonthlyHistory, getInvoiceDataSpreading, getInvoiceDataPosmSpreading } from \"../helper\";\nimport Invoice from \"./Invoice\";\nimport Modal from \"./Modal\";\nexport default function HistoryDetail(_ref) {\n  var type = _ref.type;\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState([]),\n      plan = _useState2[0],\n      setPlan = _useState2[1];\n\n  var _useState3 = useState([]),\n      productList = _useState3[0],\n      setProductList = _useState3[1];\n\n  var _useState4 = useState([]),\n      posmList = _useState4[0],\n      setPosmList = _useState4[1];\n\n  var _useState5 = useState(false),\n      pdfDownload = _useState5[0],\n      setPdfDownload = _useState5[1];\n\n  var router = useRouter();\n  var now = new Date();\n  var jsPDF = null;\n  useEffect(function () {\n    if (true) {\n      import(\"jspdf\").then(function (module) {\n        jsPDF = module[\"default\"];\n      });\n    }\n  });\n  useEffect(function () {\n    var userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (router.query.id) {\n      if (type === \"PLAN\") {\n        getPlanMonthlyHistory(userData).then(function (data) {\n          setPlan(data.filter(function (val) {\n            return val.idVisitPlan === router.query.id;\n          }));\n          setLoading(false);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n        getInvoiceData(router.query.id).then(function (data) {\n          setProductList(data);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n        getInvoiceDataPosm(router.query.id).then(function (data) {\n          setPosmList(data);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      } else if (type === \"UNPLAN\") {\n        getUnplanMonthlyHistory(userData).then(function (data) {\n          setPlan(data.filter(function (val) {\n            return val.id === router.query.id;\n          }));\n          setLoading(false);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n        getInvoiceDataUnplan(router.query.id).then(function (data) {\n          setProductList(data);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n        getInvoiceDataPosmUnplan(router.query.id).then(function (data) {\n          setPosmList(data);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      } else if (type === \"SPREADING\") {\n        getSpreadingMonthlyHistory(userData).then(function (data) {\n          setPlan(data.filter(function (val) {\n            return val.id === router.query.id;\n          }));\n          setLoading(false);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n        getInvoiceDataSpreading(router.query.id).then(function (data) {\n          setProductList(data); // console.log(\"produk\", data);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n        getInvoiceDataPosmSpreading(router.query.id).then(function (data) {\n          setPosmList(data); // console.log(\"psom\", data);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      }\n    }\n  }, [router.query.id]);\n\n  var renderDetail = function renderDetail() {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      children: [renderDataDetail(\"Jenis Channel\", plan[0].jenisChannel), renderDataDetail(\"Outlet\", plan[0].namaOutlet), renderDataDetail(\"Alamat\", plan[0].alamatOutlet), renderDataDetail(\"Catatan\", plan[0].catatan), renderDataDetail(\"Visibility\"), renderDataDetail(\"Avability\")]\n    });\n  };\n\n  var renderDataDetail = function renderDataDetail(subType, data) {\n    // const doneFormVis = state.visitPlanReducer.visibility.filter((val) => {\n    //   return val.file !== null && val.type !== null;\n    // });\n    // const doneFormAva = state.visitPlanReducer.avability;\n    return /*#__PURE__*/_jsxs(\"div\", {\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: styles.render_data,\n        children: [subType, /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            textAlign: \"right\"\n          },\n          children: subType === \"Visibility\" ? \"\".concat(posmList.length, \"/6\") : subType === \"Avability\" ? \"\".concat(productList.length, \"/25\") : \"\"\n        })]\n      }), /*#__PURE__*/_jsx(Card, {\n        style: {\n          marginTop: \"6px\",\n          borderRadius: \"5px\"\n        },\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: styles.render_value,\n          children: subType === \"Catatan\" ? /*#__PURE__*/_jsx(\"div\", {\n            style: {\n              width: \"100%\",\n              border: \"none\",\n              height: \"70px\"\n            },\n            children: data\n          }) : subType === \"Visibility\" || subType === \"Avability\" ? /*#__PURE__*/_jsxs(_Fragment, {\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: subType === \"Visibility\" ? /*#__PURE__*/_jsxs(\"div\", {\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar_now,\n                  style: {\n                    width: \"\".concat(posmList.length / 6 * 100, \"%\")\n                  }\n                })]\n              }) : subType === \"Avability\" ? /*#__PURE__*/_jsxs(\"div\", {\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar_now,\n                  style: {\n                    width: \"\".concat(productList.length / 25 * 100, \"%\")\n                  }\n                })]\n              }) : \"\"\n            }), type === \"PLAN\" ? /*#__PURE__*/_jsx(Link, {\n              href: subType === \"Visibility\" ? \"/visit/plan/history/\".concat(plan[0].idVisitPlan, \"/visibility\") : subType === \"Avability\" ? \"/visit/plan/history/\".concat(plan[0].idVisitPlan, \"/avability\") : \"\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"View\"\n                })\n              })\n            }) : type === \"UNPLAN\" ? /*#__PURE__*/_jsx(Link, {\n              href: subType === \"Visibility\" ? \"/visit/unplan/history/\".concat(plan[0].id, \"/visibility\") : subType === \"Avability\" ? \"/visit/unplan/history/\".concat(plan[0].id, \"/avability\") : \"\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"View\"\n                })\n              })\n            }) : type === \"SPREADING\" ? /*#__PURE__*/_jsx(Link, {\n              href: subType === \"Visibility\" ? \"/visit/spreading/history/\".concat(plan[0].id, \"/visibility\") : subType === \"Avability\" ? \"/visit/spreading/history/\".concat(plan[0].id, \"/avability\") : \"\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"View\"\n                })\n              })\n            }) : null]\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: data\n          })\n        })\n      })]\n    });\n  };\n\n  var print = function print() {\n    var divToDisplay = document.getElementById(\"invoice\");\n    html2canvas(divToDisplay, {\n      scale: 5\n    }).then(function (canvas) {\n      var image = {\n        type: \"jpeg\",\n        quality: 0.98\n      };\n      var margin = [0.5, 0.5];\n      var imgWidth = 8.5;\n      var pageHeight = 11;\n      var innerPageWidth = imgWidth - margin[0] * 2;\n      var innerPageHeight = pageHeight - margin[1] * 2; // Calculate the number of pages.\n\n      var pxFullHeight = canvas.height;\n      var pxPageHeight = Math.floor(canvas.width * (pageHeight / imgWidth));\n      var nPages = Math.ceil(pxFullHeight / pxPageHeight); // Define pageHeight separately so it can be trimmed on the final page.\n\n      var pageHeight = innerPageHeight; // Create a one-page canvas to split up the full image.\n\n      var pageCanvas = document.createElement(\"canvas\");\n      var pageCtx = pageCanvas.getContext(\"2d\");\n      pageCanvas.width = canvas.width;\n      pageCanvas.height = pxPageHeight; // Initialize the PDF.\n\n      var pdf = new jsPDF(\"p\", \"in\", [8.5, 11]);\n\n      for (var page = 0; page < nPages; page++) {\n        // Trim the final page to reduce file size.\n        if (page === nPages - 1 && pxFullHeight % pxPageHeight !== 0) {\n          pageCanvas.height = pxFullHeight % pxPageHeight;\n          pageHeight = pageCanvas.height * innerPageWidth / pageCanvas.width;\n        } // Display the page.\n\n\n        var w = pageCanvas.width;\n        var h = pageCanvas.height;\n        pageCtx.fillStyle = \"white\";\n        pageCtx.fillRect(0, 0, w, h);\n        pageCtx.drawImage(canvas, 0, page * pxPageHeight, w, h, 0, 0, w, h); // Add the page to the PDF.\n\n        if (page > 0) pdf.addPage();\n        debugger;\n        var imgData = pageCanvas.toDataURL(\"image/\" + image.type, image.quality);\n        pdf.addImage(imgData, image.type, margin[1], margin[0], innerPageWidth, pageHeight);\n      }\n\n      pdf.save(\"file.pdf\");\n    });\n  };\n\n  var render = function render() {\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.container,\n          children: [pdfDownload ? /*#__PURE__*/_jsx(Modal, {\n            onClick: function onClick() {\n              setPdfDownload(false);\n            },\n            children: /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                maxHeight: \"100%\",\n                overflow: \"auto\",\n                overflowX: \"hidden\",\n                overflowY: \"hidden\"\n              },\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                style: {\n                  width: \"400px\",\n                  maxHeight: \"100%\",\n                  margin: \"100px auto\"\n                },\n                children: [/*#__PURE__*/_jsx(Invoice, {\n                  data: productList,\n                  plan: plan\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    padding: \"10px\",\n                    backgroundColor: \"white\"\n                  },\n                  children: /*#__PURE__*/_jsx(Button, {\n                    onClick: function onClick() {\n                      print();\n                    },\n                    text: \"Download PDF\"\n                  })\n                })]\n              })\n            })\n          }) : null, /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.wrapper,\n            children: [/*#__PURE__*/_jsx(Nav, {\n              title: \"History\",\n              color: \"white\",\n              action: \"Download\",\n              backAction: function backAction() {\n                Router.back();\n              },\n              onClick: function onClick() {\n                setPdfDownload(true);\n              },\n              disable: false\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.main,\n              children: renderDetail()\n            })]\n          })]\n        })\n      });\n    }\n  };\n\n  return render();\n}","map":null,"metadata":{},"sourceType":"module"}