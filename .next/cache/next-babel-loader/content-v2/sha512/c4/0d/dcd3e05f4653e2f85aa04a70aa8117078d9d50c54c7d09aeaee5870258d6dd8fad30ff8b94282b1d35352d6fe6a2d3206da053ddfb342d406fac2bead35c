{"ast":null,"code":"import _defineProperty from \"C:/Users/Rico/Desktop/Home/Kalbe app/sakamor-new/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"C:/Users/Rico/Desktop/Home/Kalbe app/sakamor-new/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Rico/Desktop/Home/Kalbe app/sakamor-new/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Rico\\\\Desktop\\\\Home\\\\Kalbe app\\\\sakamor-new\\\\pages\\\\_app.js\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport \"../styles/globals.css\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Store } from \"../store\";\nimport { useEffect } from \"react\";\nimport Router from \"next/router\";\nimport { firebaseCloudMessaging } from \"../webPush\";\nimport firebase from \"firebase/app\";\nimport { getAllAnnouncement } from \"../helper\";\n\nfunction MyApp(_ref) {\n  _s();\n\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps;\n  useEffect(function () {\n    var user = localStorage.getItem(\"user\");\n\n    if (!user) {\n      Router.push(\"/login\");\n    }\n  }, []);\n  useEffect(function () {\n    setToken();\n\n    function setToken() {\n      return _setToken.apply(this, arguments);\n    }\n\n    function _setToken() {\n      _setToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return firebaseCloudMessaging.init();\n\n              case 3:\n                token = _context.sent;\n\n                if (token) {\n                  getMessage();\n                }\n\n                _context.next = 10;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                console.log(_context.t0);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 7]]);\n      }));\n      return _setToken.apply(this, arguments);\n    }\n\n    function getMessage() {\n      var userData = localStorage.getItem(\"user\");\n      var messaging = firebase.messaging();\n      console.log({\n        messaging: messaging\n      });\n      messaging.onMessage(function (message) {\n        getAllAnnouncement(userData).then(function (data) {\n          var newAnnouncement = announcementList.filter(function (val) {\n            return val.isRead === false;\n          });\n          localStorage.setItem(\"notif\", newAnnouncement);\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n\n        var _JSON$parse = JSON.parse(message.notification),\n            title = _JSON$parse.title,\n            body = _JSON$parse.body;\n\n        var options = {\n          body: body\n        };\n        self.registration.showNotification(title, options);\n      });\n    }\n  });\n  return /*#__PURE__*/_jsxDEV(Store, {\n    children: /*#__PURE__*/_jsxDEV(Component, _objectSpread({}, pageProps), void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 5\n  }, this);\n}\n\n_s(MyApp, \"3ubReDTFssvu4DHeldAg55cW/CI=\");\n\n_c = MyApp;\nexport default MyApp;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyApp\");","map":{"version":3,"sources":["C:/Users/Rico/Desktop/Home/Kalbe app/sakamor-new/pages/_app.js"],"names":["Store","useEffect","Router","firebaseCloudMessaging","firebase","getAllAnnouncement","MyApp","Component","pageProps","user","localStorage","getItem","push","setToken","init","token","getMessage","console","log","userData","messaging","onMessage","message","then","data","newAnnouncement","announcementList","filter","val","isRead","setItem","err","JSON","parse","notification","title","body","options","self","registration","showNotification"],"mappings":";;;;;;;;;;;;AAAA,OAAO,uBAAP;AACA,OAAO,sCAAP;AACA,SAASA,KAAT,QAAsB,UAAtB;AACA,SAASC,SAAT,QAA0B,OAA1B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,sBAAT,QAAuC,YAAvC;AACA,OAAOC,QAAP,MAAqB,cAArB;AACA,SAASC,kBAAT,QAAmC,WAAnC;;AAEA,SAASC,KAAT,OAAyC;AAAA;;AAAA,MAAxBC,SAAwB,QAAxBA,SAAwB;AAAA,MAAbC,SAAa,QAAbA,SAAa;AACvCP,EAAAA,SAAS,CAAC,YAAM;AACd,QAAMQ,IAAI,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAb;;AACA,QAAI,CAACF,IAAL,EAAW;AACTP,MAAAA,MAAM,CAACU,IAAP,CAAY,QAAZ;AACD;AACF,GALQ,EAKN,EALM,CAAT;AAOAX,EAAAA,SAAS,CAAC,YAAM;AACdY,IAAAA,QAAQ;;AADM,aAECA,QAFD;AAAA;AAAA;;AAAA;AAAA,2EAEd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEwBV,sBAAsB,CAACW,IAAvB,EAFxB;;AAAA;AAEUC,gBAAAA,KAFV;;AAGI,oBAAIA,KAAJ,EAAW;AACTC,kBAAAA,UAAU;AACX;;AALL;AAAA;;AAAA;AAAA;AAAA;AAOIC,gBAAAA,OAAO,CAACC,GAAR;;AAPJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAFc;AAAA;AAAA;;AAYd,aAASF,UAAT,GAAsB;AACpB,UAAMG,QAAQ,GAAGT,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAjB;AACA,UAAMS,SAAS,GAAGhB,QAAQ,CAACgB,SAAT,EAAlB;AACAH,MAAAA,OAAO,CAACC,GAAR,CAAY;AAAEE,QAAAA,SAAS,EAATA;AAAF,OAAZ;AACAA,MAAAA,SAAS,CAACC,SAAV,CAAoB,UAACC,OAAD,EAAa;AAC/BjB,QAAAA,kBAAkB,CAACc,QAAD,CAAlB,CACGI,IADH,CACQ,UAACC,IAAD,EAAU;AACd,cAAMC,eAAe,GAAGC,gBAAgB,CAACC,MAAjB,CAAwB,UAACC,GAAD,EAAS;AACvD,mBAAOA,GAAG,CAACC,MAAJ,KAAe,KAAtB;AACD,WAFuB,CAAxB;AAGAnB,UAAAA,YAAY,CAACoB,OAAb,CAAqB,OAArB,EAA8BL,eAA9B;AACD,SANH,WAOS,UAACM,GAAD,EAAS;AACdd,UAAAA,OAAO,CAACC,GAAR,CAAYa,GAAZ;AACD,SATH;;AAD+B,0BAYPC,IAAI,CAACC,KAAL,CAAWX,OAAO,CAACY,YAAnB,CAZO;AAAA,YAYvBC,KAZuB,eAYvBA,KAZuB;AAAA,YAYhBC,IAZgB,eAYhBA,IAZgB;;AAa/B,YAAIC,OAAO,GAAG;AACZD,UAAAA,IAAI,EAAJA;AADY,SAAd;AAGAE,QAAAA,IAAI,CAACC,YAAL,CAAkBC,gBAAlB,CAAmCL,KAAnC,EAA0CE,OAA1C;AACD,OAjBD;AAkBD;AACF,GAnCQ,CAAT;AAqCA,sBACE,QAAC,KAAD;AAAA,2BACE,QAAC,SAAD,oBAAe7B,SAAf;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADF;AAKD;;GAlDQF,K;;KAAAA,K;AAoDT,eAAeA,KAAf","sourcesContent":["import \"../styles/globals.css\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Store } from \"../store\";\nimport { useEffect } from \"react\";\nimport Router from \"next/router\";\nimport { firebaseCloudMessaging } from \"../webPush\";\nimport firebase from \"firebase/app\";\nimport { getAllAnnouncement } from \"../helper\";\n\nfunction MyApp({ Component, pageProps }) {\n  useEffect(() => {\n    const user = localStorage.getItem(\"user\");\n    if (!user) {\n      Router.push(\"/login\");\n    }\n  }, []);\n\n  useEffect(() => {\n    setToken();\n    async function setToken() {\n      try {\n        const token = await firebaseCloudMessaging.init();\n        if (token) {\n          getMessage();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    }\n    function getMessage() {\n      const userData = localStorage.getItem(\"user\");\n      const messaging = firebase.messaging();\n      console.log({ messaging });\n      messaging.onMessage((message) => {\n        getAllAnnouncement(userData)\n          .then((data) => {\n            const newAnnouncement = announcementList.filter((val) => {\n              return val.isRead === false;\n            });\n            localStorage.setItem(\"notif\", newAnnouncement);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n\n        const { title, body } = JSON.parse(message.notification);\n        var options = {\n          body,\n        };\n        self.registration.showNotification(title, options);\n      });\n    }\n  });\n\n  return (\n    <Store>\n      <Component {...pageProps} />\n    </Store>\n  );\n}\n\nexport default MyApp;\n"]},"metadata":{},"sourceType":"module"}