{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport Link from \"next/link\";\nimport Router, { useRouter } from \"next/router\";\nimport styles from \"../../../../styles/pages/VisitPlanDetail.module.css\";\nimport { Stores } from \"../../../../store\";\nimport Nav from \"../../../../components/Nav\";\nimport Modal from \"../../../../components/Modal\";\nimport Card from \"../../../../components/Card\";\nimport Spinner from \"../../../../components/Spinner\";\nimport Button from \"../../../../components/Button\";\nimport { submitVisitSpreadingDposm, submitVisitSpreading, getSearchJenisChannel } from \"../../../../helper\";\nexport default function index() {\n  var _useContext = useContext(Stores),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch,\n      actions = _useContext.actions;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      loadingSubmit = _useState2[0],\n      setLoadingSubmit = _useState2[1];\n\n  var _useState3 = useState(false),\n      newNOO = _useState3[0],\n      setNewNOO = _useState3[1];\n\n  var _useState4 = useState([]),\n      plan = _useState4[0],\n      setPlan = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      searchJenisChannel = _useState5[0],\n      setSearchJenisChannel = _useState5[1];\n\n  var _useState6 = useState([]),\n      listJenisChannel = _useState6[0],\n      setListJenisChannel = _useState6[1];\n\n  var _useState7 = useState(false),\n      renderListJenisChannel = _useState7[0],\n      setRenderListJenisChannel = _useState7[1];\n\n  var _useState8 = useState({}),\n      focusJenisChannel = _useState8[0],\n      setFocusJenisChannel = _useState8[1];\n\n  var _useState9 = useState(false),\n      visNotDone = _useState9[0],\n      setVisNotDone = _useState9[1];\n\n  var router = useRouter();\n  var now = new Date();\n  useEffect(function () {\n    if (router.query[\"new\"]) {\n      setNewNOO(true);\n\n      if (!state.visitSpreadingReducer.checkIn) {\n        actions.setSpreadingCheckIn(now);\n      }\n\n      setSearchJenisChannel(state.visitSpreadingReducer.jenisChannel.namaJenisChannel);\n\n      if (state.visitSpreadingReducer.jenisChannel.namaJenisChannel && state.visitSpreadingReducer.outlet.namaOutlet) {\n        setSearchJenisChannel(state.visitSpreadingReducer.jenisChannel.namaJenisChannel);\n      }\n    } else {\n      if (state.visitSpreadingReducer.jenisChannel.namaJenisChannel && state.visitSpreadingReducer.outlet.namaOutlet) {\n        if (!state.visitSpreadingReducer.checkIn) {\n          actions.setSpreadingCheckIn(now);\n        }\n\n        setSearchJenisChannel(state.visitSpreadingReducer.jenisChannel.namaJenisChannel);\n      } else {\n        Router.push(\"/visit/spreading\");\n      }\n    }\n  }, []);\n\n  var renderDetail = function renderDetail() {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      children: [renderDataDetail(\"Jenis Channel\", state.visitSpreadingReducer.jenisChannel.namaJenisChannel), renderDataDetail(\"Outlet\", state.visitSpreadingReducer.outlet.namaOutlet), renderDataDetail(\"Alamat\", state.visitSpreadingReducer.outlet.alamatOutlet), renderDataDetail(\"Catatan\", state.visitSpreadingReducer.catatan), renderDataDetail(\"Visibility\"), renderDataDetail(\"Avability\")]\n    });\n  };\n\n  var onSearchJenisChannel = function onSearchJenisChannel(search) {\n    setRenderListJenisChannel(true);\n    setSearchJenisChannel(search);\n\n    if (search) {\n      getSearchJenisChannel(search).then(function (data) {\n        setListJenisChannel(data);\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    } else {\n      setListJenisChannel([]);\n    }\n  };\n\n  var renderSearchJenisChannel = function renderSearchJenisChannel() {\n    var render = listJenisChannel.map(function (val, index) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        onClick: function onClick() {\n          setFocusJenisChannel(val);\n          actions.setSpreadingJenisChannel(val);\n          setSearchJenisChannel(val.namaJenisChannel);\n          setListJenisChannel([]);\n        },\n        style: {\n          borderBottom: \".5px solid #f0f0f0\",\n          width: \"350px\"\n        },\n        children: val.namaJenisChannel\n      }, index);\n    });\n    return render;\n  };\n\n  var renderDataDetail = function renderDataDetail(type, data) {\n    var doneFormVis = state.visitSpreadingReducer.visibility.filter(function (val) {\n      return val.file !== null && val.type !== null;\n    });\n    var doneFormAva = state.visitSpreadingReducer.avability;\n\n    if (newNOO) {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.render_data,\n          children: [type, /*#__PURE__*/_jsx(\"div\", {\n            style: {\n              textAlign: \"right\"\n            },\n            children: type === \"Visibility\" ? \"\".concat(doneFormVis.length, \"/6\") : type === \"Avability\" ? \"\".concat(doneFormAva.length, \"/25\") : \"\"\n          })]\n        }), type === \"Jenis Channel\" ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"input\", {\n            onChange: function onChange(e) {\n              onSearchJenisChannel(e.target.value);\n              actions.setSpreadingAvability([]);\n            },\n            value: searchJenisChannel,\n            placeholder: \"Search\",\n            className: styles.input,\n            onBlur: function onBlur() {\n              setTimeout(function () {\n                setRenderListJenisChannel(false);\n              }, 200);\n            },\n            onFocus: function onFocus(e) {\n              return onSearchJenisChannel(e.target.value);\n            }\n          }), renderListJenisChannel ? /*#__PURE__*/_jsx(\"div\", {\n            style: {\n              position: \"absolute\",\n              maxHeight: \"180px\",\n              backgroundColor: \"white\",\n              overflowY: \"scroll\",\n              maxWidth: \"400px\",\n              padding: \"0 4px\",\n              zIndex: 999999,\n              marginTop: \"-10px\"\n            },\n            children: renderSearchJenisChannel()\n          }) : null]\n        }) : type === \"Outlet\" ? /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"6px\",\n            borderRadius: \"5px\"\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: styles.render_value,\n            children: /*#__PURE__*/_jsx(\"textarea\", {\n              style: {\n                width: \"100%\",\n                border: \"none\",\n                height: \"20px\"\n              },\n              onChange: function onChange(e) {\n                actions.setSpreadingNewOutlet(e.target.value);\n              },\n              value: state.visitSpreadingReducer.newOutlet\n            })\n          })\n        }) : type === \"Alamat\" ? /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"6px\",\n            borderRadius: \"5px\"\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: styles.render_value,\n            children: /*#__PURE__*/_jsx(\"textarea\", {\n              style: {\n                width: \"100%\",\n                border: \"none\",\n                height: \"70px\"\n              },\n              onChange: function onChange(e) {\n                actions.setSpreadingAlamat(e.target.value);\n              },\n              value: state.visitSpreadingReducer.alamat\n            })\n          })\n        }) : type === \"Catatan\" ? /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"6px\",\n            borderRadius: \"5px\"\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: styles.render_value,\n            children: /*#__PURE__*/_jsx(\"textarea\", {\n              style: {\n                width: \"100%\",\n                border: \"none\",\n                height: \"70px\"\n              },\n              onChange: function onChange(e) {\n                actions.setSpreadingCatatan(e.target.value);\n              },\n              value: state.visitSpreadingReducer.catatan\n            })\n          })\n        }) : type === \"Visibility\" || type === \"Avability\" ? /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"6px\",\n            borderRadius: \"5px\"\n          },\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.render_value,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: type === \"Visibility\" ? /*#__PURE__*/_jsxs(\"div\", {\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar_now,\n                  style: {\n                    width: \"\".concat(doneFormVis.length / 6 * 100, \"%\")\n                  }\n                })]\n              }) : type === \"Avability\" ? /*#__PURE__*/_jsxs(\"div\", {\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: styles.progress_bar_now,\n                  style: {\n                    width: \"\".concat(doneFormAva.length / 25 * 100, \"%\")\n                  }\n                })]\n              }) : \"\"\n            }), type === \"Avability\" ? state.visitSpreadingReducer.jenisChannel.namaJenisChannel ? /*#__PURE__*/_jsx(Link, {\n              href: \"/visit/spreading/submit/avability?new=true\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"Add\"\n                })\n              })\n            }) : /*#__PURE__*/_jsx(Button, {\n              text: \"Add\"\n            }) : type === \"Visibility\" ? /*#__PURE__*/_jsx(Link, {\n              href: \"/visit/spreading/submit/visibility?new=true\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"Add\"\n                })\n              })\n            }) : null]\n          })\n        }) : /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"6px\",\n            borderRadius: \"5px\"\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: styles.render_value,\n            children: /*#__PURE__*/_jsx(_Fragment, {\n              children: data\n            })\n          })\n        })]\n      });\n    } else {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: styles.render_data,\n          children: [type, /*#__PURE__*/_jsx(\"div\", {\n            style: {\n              textAlign: \"right\"\n            },\n            children: type === \"Visibility\" ? \"\".concat(doneFormVis.length, \"/6\") : type === \"Avability\" ? \"\".concat(doneFormAva.length, \"/25\") : \"\"\n          })]\n        }), /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"6px\",\n            borderRadius: \"5px\"\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: styles.render_value,\n            children: type === \"Catatan\" ? /*#__PURE__*/_jsx(\"textarea\", {\n              style: {\n                width: \"100%\",\n                border: \"none\",\n                height: \"70px\"\n              },\n              onChange: function onChange(e) {\n                actions.setSpreadingCatatan(e.target.value);\n              },\n              value: state.visitSpreadingReducer.catatan\n            }) : type === \"Visibility\" || type === \"Avability\" ? /*#__PURE__*/_jsxs(_Fragment, {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                children: type === \"Visibility\" ? /*#__PURE__*/_jsxs(\"div\", {\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: styles.progress_bar\n                  }), /*#__PURE__*/_jsx(\"div\", {\n                    className: styles.progress_bar_now,\n                    style: {\n                      width: \"\".concat(doneFormVis.length / 6 * 100, \"%\")\n                    }\n                  })]\n                }) : type === \"Avability\" ? /*#__PURE__*/_jsxs(\"div\", {\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: styles.progress_bar\n                  }), /*#__PURE__*/_jsx(\"div\", {\n                    className: styles.progress_bar_now,\n                    style: {\n                      width: \"\".concat(doneFormAva.length / 25 * 100, \"%\")\n                    }\n                  })]\n                }) : \"\"\n              }), /*#__PURE__*/_jsx(Link, {\n                href: type === \"Visibility\" ? \"/visit/spreading/submit/visibility\" : type === \"Avability\" ? \"/visit/spreading/submit/avability\" : \"\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: /*#__PURE__*/_jsx(Button, {\n                    text: \"Add\"\n                  })\n                })\n              })]\n            }) : /*#__PURE__*/_jsx(_Fragment, {\n              children: data\n            })\n          })\n        })]\n      });\n    }\n  };\n\n  var onSubmit = function onSubmit() {\n    var visDone = state.visitSpreadingReducer.visibility.filter(function (val) {\n      return val.file !== null && val.type !== null;\n    });\n\n    if (visDone.length === 6) {\n      setLoadingSubmit(true);\n      setVisNotDone(false);\n      var userData = JSON.parse(localStorage.getItem(\"user\"));\n      var bodyPlan = {\n        usernameSMR: userData.username,\n        nomorDokumen: \"\",\n        catatan: state.visitSpreadingReducer.catatan,\n        idJenisChannel: parseInt(state.visitSpreadingReducer.jenisChannel.jenisChannelID),\n        jenisChannel: state.visitSpreadingReducer.jenisChannel.namaJenisChannel,\n        idOutlet: state.visitSpreadingReducer.outlet.outletID,\n        namaOutlet: state.visitSpreadingReducer.outlet.namaOutlet,\n        alamatOutlet: state.visitSpreadingReducer.outlet.alamatOutlet,\n        tanggal: now.toISOString(),\n        target: 0,\n        sales: 0,\n        isCheckIn: true,\n        checkInDate: state.visitSpreadingReducer.checkIn.toISOString(),\n        isCheckOut: true,\n        checkOutDate: now.toISOString(),\n        createdBy: userData.username,\n        updatedBy: userData.username\n      };\n      var bodyPlanNewNOO = {\n        usernameSMR: userData.username,\n        nomorDokumen: \"\",\n        catatan: state.visitSpreadingReducer.catatan,\n        idJenisChannel: parseInt(state.visitSpreadingReducer.jenisChannel.jenisChannelID),\n        jenisChannel: state.visitSpreadingReducer.jenisChannel.namaJenisChannel,\n        idOutlet: \"\",\n        namaOutlet: state.visitSpreadingReducer.newOutlet,\n        alamatOutlet: state.visitSpreadingReducer.alamat,\n        tanggal: now.toISOString(),\n        target: 0,\n        sales: 0,\n        isCheckIn: true,\n        checkInDate: state.visitSpreadingReducer.checkIn.toISOString(),\n        isCheckOut: true,\n        checkOutDate: now.toISOString(),\n        createdBy: userData.username,\n        updatedBy: userData.username\n      };\n      var files = state.visitSpreadingReducer.visibility.map(function (val, index) {\n        return val.file;\n      });\n      var bodyProduct = state.visitSpreadingReducer.avability.map(function (val, index) {\n        return {\n          nomorDokumen: \"\",\n          nomor: index,\n          kodeProduk: val.productFocus.produkID,\n          namaProduk: val.productFocus.namaProduk,\n          stok: parseInt(val.stock),\n          saranOrder: parseInt(val.saranOrder),\n          jumlahOrder: parseInt(val.order),\n          harga: parseInt(val.harga),\n          totalHarga: parseInt(val.harga) * parseInt(val.order),\n          keterangan: val.ket,\n          createdBy: userData.username,\n          updatedBy: userData.username\n        };\n      });\n      var data = {\n        spreadingSave: bodyPlan,\n        dProductList: bodyProduct\n      };\n      var dataNewNOO = {\n        spreadingSave: bodyPlanNewNOO,\n        dProductList: bodyProduct\n      };\n      console.log(data, state.visitSpreadingReducer.avability);\n\n      if (newNOO) {\n        if (state.visitSpreadingReducer.newOutlet && state.visitSpreadingReducer.jenisChannel.namaJenisChannel && state.visitSpreadingReducer.alamat) {\n          submitVisitSpreading(dataNewNOO).then(function (res) {\n            console.log(\"ini res\", res);\n            var bodyPosm = state.visitSpreadingReducer.visibility.map(function (val, index) {\n              return {\n                activitySpreadingId: res.spreadingSave.id,\n                nomor: index,\n                tipe: val.type.program,\n                namaFile: val.file.name,\n                createdBy: userData.username,\n                updatedBy: userData.username\n              };\n            });\n\n            var _loop = function _loop(i) {\n              submitVisitSpreadingDposm(bodyPosm[i], files[i]).then(function (res) {\n                if (i === 5) {\n                  setLoadingSubmit(false);\n                  Router.push(\"/\");\n                  actions.setDefaultVisitSpreading();\n                }\n              })[\"catch\"](function (err) {\n                console.log(err);\n              });\n            };\n\n            for (var i = 0; i < files.length; i++) {\n              _loop(i);\n            }\n          })[\"catch\"](function (err) {\n            console.log(err);\n          });\n        } else {\n          setLoadingSubmit(false);\n        }\n      } else {\n        submitVisitSpreading(data).then(function (res) {\n          console.log(\"ini res\", res);\n          var bodyPosm = state.visitSpreadingReducer.visibility.map(function (val, index) {\n            return {\n              activitySpreadingId: res.spreadingSave.id,\n              nomor: index,\n              tipe: val.type.program,\n              namaFile: val.file.name,\n              createdBy: userData.username,\n              updatedBy: userData.username\n            };\n          });\n\n          var _loop2 = function _loop2(i) {\n            submitVisitSpreadingDposm(bodyPosm[i], files[i]).then(function (res) {\n              if (i === 5) {\n                setLoadingSubmit(false);\n                Router.push(\"/\");\n                actions.setDefaultVisitSpreading();\n              }\n            })[\"catch\"](function (err) {\n              console.log(err);\n            });\n          };\n\n          for (var i = 0; i < files.length; i++) {\n            _loop2(i);\n          }\n        })[\"catch\"](function (err) {\n          console.log(err);\n        });\n      }\n    } else {\n      setVisNotDone(true);\n    }\n  };\n\n  var render = function render() {\n    var visDone = state.visitSpreadingReducer.visibility.filter(function (val) {\n      return val.file !== null && val.type !== null;\n    });\n\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.container,\n        children: [loadingSubmit ? /*#__PURE__*/_jsx(Modal, {\n          children: /*#__PURE__*/_jsx(Spinner, {})\n        }) : null, /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.wrapper,\n          children: [/*#__PURE__*/_jsx(Nav, {\n            title: newNOO ? \"New Outlet\" : \"Spreading\",\n            color: \"white\",\n            action: \"Submit\",\n            onClick: function onClick() {\n              onSubmit();\n            },\n            backAction: function backAction() {\n              if (confirm(\"Data will be lost if you leave the page, are you sure?\")) {\n                actions.setDefaultVisitSpreading();\n                Router.push(\"/visit/spreading\");\n              }\n            },\n            disable: visDone.length === 6 ? false : true\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.main,\n            children: [visNotDone ? /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                color: \"red\",\n                fontSize: \"13px\",\n                textAlign: \"center\"\n              },\n              children: \"Please complete visibility data\"\n            }) : \"\", renderDetail()]\n          })]\n        })]\n      });\n    }\n  };\n\n  return render();\n}","map":null,"metadata":{},"sourceType":"module"}