{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useContext, useEffect } from \"react\";\nimport Head from \"next/head\";\nimport styles from \"../styles/pages/Home.module.css\";\nimport Router from \"next/router\";\nimport Link from \"next/link\";\nimport { Stores } from \"../store\";\nimport Spinner from \"../components/Spinner\";\nimport BotNav from \"../components/BotNav\";\nimport Button from \"../components/Button\";\nimport Card from \"../components/Card\";\nimport { getAuth, getMenu, getPlanHistory, getPlanList, getUnplanMonthlyHistory } from \"../helper\";\nimport { Doughnut } from \"react-chartjs-2\";\nimport moment from \"moment\";\nexport default function Home() {\n  const {\n    state,\n    dispatch,\n    actions\n  } = useContext(Stores);\n  const {\n    0: focus,\n    1: setFocus\n  } = useState(\"\");\n  const {\n    0: plan,\n    1: setPlan\n  } = useState([]);\n  const {\n    0: planHistory,\n    1: setPlanHistory\n  } = useState([]);\n  const {\n    0: spreadingHistory,\n    1: setSpreadingHistory\n  } = useState([]);\n  const {\n    0: unplanHistory,\n    1: setUnplanHistory\n  } = useState([]);\n  const {\n    0: role,\n    1: setRole\n  } = useState(\"\");\n  const {\n    0: topMenu,\n    1: setTopMenu\n  } = useState([]);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const {\n    0: loadingMenu,\n    1: setLoadingMenu\n  } = useState(true);\n  const dataPlan = {\n    datasets: [{\n      data: planHistory.length === 0 ? [0, 1] : [planHistory.length, plan.length],\n      backgroundColor: [\"#41867a\", \"#d1e4e1\"]\n    }]\n  };\n  const dataSpreading = {\n    datasets: [{\n      data: spreadingHistory.length === 0 ? [0, 1] : [0, 1],\n      backgroundColor: [\"#41867a\", \"#d1e4e1\"]\n    }]\n  };\n  const donutOptions = {\n    cutoutPercentage: 75,\n    tooltips: {\n      enabled: false\n    },\n    hover: {\n      mode: null\n    },\n    responsive: true,\n    maintainAspectRatio: true\n  };\n  useEffect(() => {\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (userData) {\n      actions.userLogin(userData);\n      getMenu(userData).then(data => {\n        actions.setMenu(data);\n        setTopMenu(data);\n        setLoadingMenu(false);\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      Router.push(\"/\");\n    }\n  }, [dispatch]);\n  useEffect(() => {\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (userData) {\n      getAuth(userData).then(data => {\n        if (data[0].roleCode === \"PIMCA\") {\n          setRole(\"PIMCA\");\n          setFocus(\"WORK_VISIT\");\n        } else if (data[0].roleCode === \"SMR\") {\n          setRole(\"SMR\");\n          setFocus(\"PLAN\");\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      Router.push(\"/\");\n    }\n  }, [dispatch]);\n  useEffect(() => {\n    setLoading(true);\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (userData) {\n      if (focus === \"PLAN\") {\n        getPlanList(userData).then(data => {\n          setPlan(data);\n          setLoading(false);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else if (focus === \"WORK_VISIT\") {\n        console.log(\"work visit\");\n        setLoading(false);\n      }\n    } else {\n      Router.push(\"/\");\n    }\n  }, [focus]);\n  useEffect(() => {\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (focus === \"PLAN\") {\n      getPlanHistory(userData).then(data => {\n        setPlanHistory(data);\n        setLoading(false); // console.log(data);\n      }).catch(err => {\n        console.log(err);\n      });\n    } else if (focus === \"UNPLAN\") {\n      getUnplanMonthlyHistory(userData).then(data => {\n        // console.log(data);\n        setUnplanHistory(data);\n        setLoading(false);\n      }).catch(err => {\n        console.log(err);\n      });\n    } else if (focus === \"SPREADING\") {\n      setLoading(false);\n    }\n  }, [focus]);\n\n  const renderTopMenu = () => {\n    var auth = topMenu.filter(val => {\n      if (role === \"SMR\") {\n        return val.moduleCode === \"PLAN\" || val.moduleCode === \"UNPLAN\" || val.moduleCode === \"SPREADING\";\n      } else if (role === \"PIMCA\") {\n        return val.moduleCode === \"WORK-VISIT\";\n      }\n    });\n\n    const render = () => {\n      return auth.map((val, index) => {\n        return /*#__PURE__*/_jsx(\"div\", {\n          className: focus === val.moduleCode ? styles.focus_menu : styles.menu,\n          onClick: () => {\n            setFocus(val.moduleCode);\n          },\n          children: val.moduleCode === \"PLAN\" ? \"Plan\" : val.moduleCode === \"UNPLAN\" ? \"Unplan\" : val.moduleCode === \"SPREADING\" ? \"Spreading\" : val.moduleCode === \"WORK-VISIT\" ? \"Work Visit\" : \"\"\n        }, index);\n      });\n    };\n\n    if (auth) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: auth.length === 3 ? styles.menu_grid3 : auth.length === 1 ? styles.menu_grid1 : \"\",\n        children: render()\n      });\n    }\n  };\n\n  const renderList = (type, data) => {\n    if (data.length === 0) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        style: {\n          fontSize: \"15px\",\n          color: \"rgb(208, 208, 208)\",\n          textAlign: \"left\",\n          margin: \"30px 0\"\n        },\n        children: \"No Item\"\n      });\n    } else {\n      return data.map((val, index) => {\n        return /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            fontSize: \"15px\",\n            fontWeight: \"700\",\n            color: \"#5E5873\",\n            textAlign: \"left\",\n            margin: \"10px 0\"\n          },\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            style: {\n              display: \"grid\",\n              gridTemplateColumns: \"12% 88%\"\n            },\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              style: {\n                width: \"20px\",\n                height: \"20px\",\n                backgroundColor: type === \"PLAN\" ? \"#FFF1CC\" : \"#d1e4e1\",\n                borderRadius: \"20px\",\n                padding: \"4px\"\n              },\n              children: /*#__PURE__*/_jsx(\"div\", {\n                style: {\n                  width: \"12px\",\n                  height: \"12px\",\n                  backgroundColor: type === \"PLAN\" ? \"#feb800\" : \"#41867a\",\n                  borderRadius: \"20px\"\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                children: val.namaOutlet\n              }), /*#__PURE__*/_jsx(\"div\", {\n                style: {\n                  fontSize: \"14px\",\n                  fontWeight: \"300\"\n                },\n                children: val.alamatOutlet\n              })]\n            })]\n          })\n        }, index);\n      });\n    }\n  };\n\n  const renderPlan = () => {\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Card, {\n          style: {\n            borderRadius: \"5px\",\n            marginTop: \"22px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.overview,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: styles.date,\n                children: moment().format(\"D / MMM / YYYY\")\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                style: {\n                  color: \"#5E5873\",\n                  marginTop: \"7px\"\n                },\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  style: {\n                    fontSize: \"36px\",\n                    fontWeight: \"600\"\n                  },\n                  children: planHistory.length\n                }), /*#__PURE__*/_jsxs(\"span\", {\n                  style: {\n                    fontSize: \"18px\"\n                  },\n                  children: [\"/\", plan.length + planHistory.length]\n                })]\n              }), /*#__PURE__*/_jsx(\"button\", {\n                style: {\n                  marginTop: \"7px\",\n                  backgroundColor: \"#FEB800\",\n                  padding: \"10px 22px\",\n                  fontSize: \"14px\",\n                  fontWeight: \"400\",\n                  color: \"#fff\",\n                  border: \"none\",\n                  borderRadius: \"5px\"\n                },\n                children: \"Add New Plan +\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: styles.pie_percentage,\n                children: planHistory.length === 0 ? \"0%\" : `${Math.round(planHistory.length / (plan.length + planHistory.length) * 100)}%`\n              }), /*#__PURE__*/_jsx(Doughnut, {\n                data: dataPlan,\n                options: donutOptions,\n                width: 100,\n                height: 100\n              })]\n            })]\n          })\n        }), /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"22px\",\n            borderRadius: \"30px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.plan_container,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              style: {\n                fontSize: \"18px\",\n                fontWeight: \"500\",\n                color: \"#5E5873\",\n                textAlign: \"left\"\n              },\n              children: \"Your Plan Today\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                margin: \"22px 0\"\n              },\n              children: renderList(\"PLAN\", plan)\n            }), /*#__PURE__*/_jsx(Link, {\n              href: \"/visit/plan\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"See Details\"\n                })\n              })\n            })]\n          })\n        })]\n      });\n    }\n  };\n\n  const renderSpreading = () => {\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Card, {\n          style: {\n            borderRadius: \"5px\",\n            marginTop: \"22px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.overview,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: styles.date,\n                children: moment().format(\"D / MMM / YYYY\")\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                style: {\n                  color: \"#5E5873\",\n                  marginTop: \"7px\"\n                },\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  style: {\n                    fontSize: \"36px\",\n                    fontWeight: \"600\"\n                  },\n                  children: \"0\"\n                }), /*#__PURE__*/_jsxs(\"span\", {\n                  style: {\n                    fontSize: \"18px\"\n                  },\n                  children: [\"/\", plan.length]\n                })]\n              }), /*#__PURE__*/_jsx(Link, {\n                href: \"/visit/spreading/\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: /*#__PURE__*/_jsx(\"button\", {\n                    style: {\n                      marginTop: \"7px\",\n                      backgroundColor: \"#FEB800\",\n                      padding: \"10px 22px\",\n                      fontSize: \"14px\",\n                      fontWeight: \"400\",\n                      color: \"#fff\",\n                      border: \"none\",\n                      borderRadius: \"5px\"\n                    },\n                    children: \"Add New NOO +\"\n                  })\n                })\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: styles.pie_percentage,\n                children: \"0%\"\n              }), /*#__PURE__*/_jsx(Doughnut, {\n                data: dataSpreading,\n                options: donutOptions,\n                width: 100,\n                height: 100\n              })]\n            })]\n          })\n        }), /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"22px\",\n            borderRadius: \"30px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.plan_container,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              style: {\n                fontSize: \"18px\",\n                fontWeight: \"500\",\n                color: \"#5E5873\",\n                textAlign: \"left\"\n              },\n              children: \"Spreading History\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                margin: \"22px 0\"\n              },\n              children: renderList(\"SPREADING\", spreadingHistory)\n            }), /*#__PURE__*/_jsx(Link, {\n              href: \"/visit/spreading/history\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"See Details\"\n                })\n              })\n            })]\n          })\n        })]\n      });\n    }\n  };\n\n  const renderUnplan = () => {\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Card, {\n          style: {\n            borderRadius: \"5px\",\n            marginTop: \"22px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.unplan_grid,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.num_total_unplan,\n              children: unplanHistory.length\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                fontSize: \"14px\"\n              },\n              children: \"Total Unplan Visit\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.date,\n              children: moment().format(\"MMMM\")\n            })]\n          })\n        }), /*#__PURE__*/_jsx(Card, {\n          style: {\n            borderRadius: \"5px\",\n            marginTop: \"11px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/visit/unplan\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              style: {\n                textDecoration: \"none\"\n              },\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.unplan_grid2,\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.add_unplan,\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    style: {\n                      marginTop: \"-8px\"\n                    },\n                    children: \"+\"\n                  })\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  style: {\n                    fontSize: \"16px\",\n                    fontWeight: \"600\"\n                  },\n                  children: [\"Any Unplan Visit?\", /*#__PURE__*/_jsx(\"div\", {\n                    style: {\n                      color: \"#B9B9C3\",\n                      fontWeight: \"300\",\n                      fontSize: \"13px\"\n                    },\n                    children: \"Add your unplan visit here\"\n                  }), \" \"]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    textAlign: \"center\"\n                  },\n                  children: /*#__PURE__*/_jsx(\"img\", {\n                    src: \"/next.svg\"\n                  })\n                })]\n              })\n            })\n          })\n        }), /*#__PURE__*/_jsx(Card, {\n          style: {\n            marginTop: \"22px\",\n            borderRadius: \"30px\"\n          },\n          shadow: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.plan_container,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              style: {\n                fontSize: \"18px\",\n                fontWeight: \"500\",\n                color: \"#5E5873\",\n                textAlign: \"left\"\n              },\n              children: \"Unplan Visit History\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                margin: \"22px 0\"\n              },\n              children: renderList(\"UNPLAN\", unplanHistory)\n            }), /*#__PURE__*/_jsx(Link, {\n              href: \"/visit/unplan/history\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(Button, {\n                  text: \"See Details\"\n                })\n              })\n            })]\n          })\n        })]\n      });\n    }\n  };\n\n  const renderWorkVisit = () => {};\n\n  const renderPage = () => {\n    if (loading && loadingMenu) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsxs(Head, {\n          children: [/*#__PURE__*/_jsx(\"title\", {\n            children: \"Home\"\n          }), /*#__PURE__*/_jsx(\"link\", {\n            rel: \"icon\",\n            href: \"/favicon.ico\"\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.container,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.wrapper,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.bg_top\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: styles.user_info_grid,\n              children: [/*#__PURE__*/_jsx(\"img\", {\n                className: styles.pp,\n                src: \"/pp.png\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                style: {\n                  marginLeft: \"15px\"\n                },\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    fontSize: \"14px\"\n                  },\n                  children: state.userReducer.user.name\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    fontSize: \"12px\"\n                  },\n                  children: role\n                })]\n              }), /*#__PURE__*/_jsx(\"img\", {\n                className: styles.notif,\n                src: \"/notif.svg\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.main,\n                children: [renderTopMenu(), focus === \"PLAN\" ? renderPlan() : focus === \"UNPLAN\" ? renderUnplan() : focus === \"SPREADING\" ? renderSpreading() : focus === \"WORK-VISIT\" ? renderWorkVisit() : \"\", /*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    marginBottom: \"120px\"\n                  }\n                })]\n              })]\n            })]\n          })\n        }), /*#__PURE__*/_jsx(BotNav, {})]\n      });\n    }\n  };\n\n  return renderPage();\n}","map":null,"metadata":{},"sourceType":"module"}