{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport Link from \"next/link\";\nimport Router from \"next/router\";\nimport { Stores } from \"../store\";\nimport styles from \"../styles/pages/MasterPlanVisit.module.css\";\nimport Nav from \"../components/Nav\";\nimport Spinner from \"../components/Spinner\";\nimport Button from \"../components/Button\";\nimport { getAuth, getPlanList, getSearchOutlet, getSearchJenisChannel, getMasterVisitPlan, deleteMasterPlanSMR, saveMasterPlanVisit } from \"../helper\";\nimport moment from \"moment\";\nimport Card from \"../components/Card\";\nexport default function Plan() {\n  const {\n    state,\n    dispatch,\n    actions\n  } = useContext(Stores);\n  const {\n    0: search,\n    1: setSearch\n  } = useState(\"\");\n  const {\n    0: dateInput,\n    1: setDateInput\n  } = useState(new Date());\n  const {\n    0: masterPlanList,\n    1: setMasterPlanList\n  } = useState([]);\n  const {\n    0: modal,\n    1: setModal\n  } = useState(false);\n  const {\n    0: searchJenisChannel,\n    1: setSearchJenisChannel\n  } = useState(\"\");\n  const {\n    0: listJenisChannel,\n    1: setListJenisChannel\n  } = useState([]);\n  const {\n    0: renderListJenisChannel,\n    1: setRenderListJenisChannel\n  } = useState(false);\n  const {\n    0: focusJenisChannel,\n    1: setFocusJenisChannel\n  } = useState({});\n  const {\n    0: searchOutlet,\n    1: setSearchOutlet\n  } = useState(\"\");\n  const {\n    0: listOutlet,\n    1: setListOutlet\n  } = useState([]);\n  const {\n    0: renderListOutlet,\n    1: setRenderListOutlet\n  } = useState(false);\n  const {\n    0: focusOutlet,\n    1: setFocusOutlet\n  } = useState({});\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n\n  const getMasterVisitList = () => {\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (userData) {\n      getMasterVisitPlan(userData).then(data => {\n        setMasterPlanList(data);\n        console.log(data);\n        setLoading(false);\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  };\n\n  useEffect(() => {\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n    const userMenu = JSON.parse(localStorage.getItem(\"menu\"));\n\n    if (userData) {\n      getAuth(userData).then(data => {\n        var auth = data.filter(val => {\n          return val.moduleCode === \"PLAN\";\n        });\n        var menu = userMenu.filter(val => {\n          return val.moduleCode === \"PLAN\";\n        });\n\n        if (!(auth && menu)) {\n          Router.push(\"/\");\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      Router.push(\"/\");\n    }\n  }, [dispatch]);\n  useEffect(() => {\n    getMasterVisitList();\n  }, [dispatch]);\n  useEffect(() => {\n    // fetch on stop typing\n    const timeoutId = setTimeout(() => {\n      if (focusJenisChannel.jenisChannelID) {\n        getSearchOutlet(focusJenisChannel.jenisChannelID, searchOutlet).then(data => {\n          setListOutlet(data);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        setListOutlet([]);\n      }\n    }, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [searchOutlet]);\n  useEffect(() => {\n    // fetch on stop typing\n    const timeoutId = setTimeout(() => {\n      getSearchJenisChannel(searchJenisChannel).then(data => {\n        setListJenisChannel(data);\n      }).catch(err => {\n        console.log(err);\n      });\n    }, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [searchJenisChannel]);\n\n  const renderSearchJenisChannel = () => {\n    const render = listJenisChannel.map((val, index) => {\n      return /*#__PURE__*/_jsx(\"div\", {\n        onClick: () => {\n          setFocusJenisChannel(val);\n          setSearchJenisChannel(val.namaJenisChannel);\n          setListJenisChannel([]);\n          setSearchOutlet(\"\");\n          setFocusOutlet({});\n          console.log(val);\n        },\n        style: {\n          borderBottom: \".5px solid #f0f0f0\",\n          width: \"350px\"\n        },\n        children: val.namaJenisChannel\n      }, index);\n    });\n    return render;\n  };\n\n  const renderSearchOutlet = () => {\n    const render = listOutlet.map((val, index) => {\n      return /*#__PURE__*/_jsx(\"div\", {\n        onClick: () => {\n          setFocusOutlet(val);\n          setSearchOutlet(val.namaOutlet);\n          setListOutlet([]);\n          console.log(val);\n        },\n        style: {\n          borderBottom: \".5px solid #f0f0f0\",\n          width: \"350px\"\n        },\n        children: val.namaOutlet\n      }, index);\n    });\n    return render;\n  };\n\n  const onSearchJenisChannel = search => {\n    setRenderListJenisChannel(true);\n    setSearchJenisChannel(search);\n  };\n\n  const onSearchOutlet = search => {\n    setRenderListOutlet(true);\n    setSearchOutlet(search);\n  };\n\n  const postMasterVisit = () => {\n    const userData = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (userData.username && focusJenisChannel.jenisChannelID && focusJenisChannel.namaJenisChannel && focusOutlet.namaOutlet && focusOutlet.alamatOutlet && focusOutlet.outletID && dateInput) {\n      var data = {\n        nomorDokumen: \"\",\n        usernameSMR: userData.username,\n        idJenisChannel: parseInt(focusJenisChannel.jenisChannelID),\n        jenisChannel: focusJenisChannel.namaJenisChannel,\n        idOutlet: focusOutlet.outletID,\n        namaOutlet: focusOutlet.namaOutlet,\n        alamatOutlet: focusOutlet.alamatOutlet,\n        tanggal: dateInput.toISOString(),\n        target: 0,\n        sales: 0,\n        createdBy: userData.username,\n        updatedBy: userData.username\n      };\n      console.log(data);\n      saveMasterPlanVisit(data).then(res => {\n        console.log(res);\n        setModal(false);\n        getMasterVisitList();\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  };\n\n  const renderModalAdd = () => {\n    if (modal) {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.modal_avability,\n          onClick: () => {\n            setModal(false);\n            setFocusJenisChannel({});\n            setFocusOutlet({});\n            setSearchJenisChannel(\"\");\n            setSearchOutlet(\"\");\n          }\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.wrapper,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.avability_modal_container,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: styles.add_title,\n              children: \"Add Plan Visit\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.avability_modal_subtitle,\n              children: \"Jenis Channel\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              onChange: e => {\n                onSearchJenisChannel(e.target.value);\n                setFocusJenisChannel({});\n                setSearchOutlet(\"\");\n                setFocusOutlet({});\n              },\n              value: searchJenisChannel,\n              placeholder: \"Search\",\n              className: styles.input,\n              onBlur: () => {\n                setTimeout(() => {\n                  setRenderListJenisChannel(false);\n                }, 200);\n              },\n              onFocus: e => onSearchJenisChannel(e.target.value)\n            }), renderListJenisChannel ? /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                position: \"absolute\",\n                maxHeight: \"180px\",\n                backgroundColor: \"white\",\n                overflowY: \"scroll\",\n                maxWidth: \"400px\",\n                padding: \"0 4px\",\n                zIndex: 999999\n              },\n              children: renderSearchJenisChannel()\n            }) : null, /*#__PURE__*/_jsx(\"div\", {\n              className: styles.avability_modal_subtitle,\n              children: \"Outlet\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              disabled: focusJenisChannel.namaJenisChannel ? false : true,\n              onChange: e => {\n                onSearchOutlet(e.target.value);\n              },\n              value: searchOutlet,\n              placeholder: \"Search\",\n              className: styles.input,\n              onBlur: () => {\n                setTimeout(() => {\n                  setRenderListOutlet(false);\n                }, 200);\n              },\n              onFocus: e => onSearchOutlet(e.target.value)\n            }), renderListOutlet ? /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                position: \"absolute\",\n                maxHeight: \"180px\",\n                backgroundColor: \"white\",\n                overflowY: \"scroll\",\n                maxWidth: \"400px\",\n                padding: \"0 4px\",\n                zIndex: 999999\n              },\n              children: renderSearchOutlet()\n            }) : null, /*#__PURE__*/_jsx(\"div\", {\n              className: styles.avability_modal_subtitle,\n              children: \"Alamat\"\n            }), focusOutlet.alamatOutlet ? /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                padding: \"4px 10px\"\n              },\n              children: focusOutlet.alamatOutlet\n            }) : /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                height: \"64px\"\n              }\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                marginTop: \"20px\"\n              },\n              children: /*#__PURE__*/_jsx(Button, {\n                text: \"Add\",\n                onClick: () => {\n                  postMasterVisit();\n                }\n              })\n            })]\n          })\n        })]\n      });\n    }\n  };\n\n  const onDeleteVisit = id => {\n    if (confirm(\"Visit will be deleted, are you sure?\")) {\n      deleteMasterPlanSMR(id).then(() => {\n        getMasterVisitList();\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  };\n\n  const renderMasterPlanList = () => {\n    return masterPlanList.map(val => {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        style: {\n          padding: \"10px 20px\",\n          fontSize: \"14px\",\n          display: \"grid\",\n          gridTemplateColumns: \"80% 20%\"\n        },\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            style: {\n              fontWeight: \"500\"\n            },\n            children: val.namaOutlet\n          }), /*#__PURE__*/_jsx(\"div\", {\n            style: {\n              fontWeight: \"400\",\n              color: \"#B9B9C3\"\n            },\n            children: moment(val.tanggal).format(\"DD MMMM YYYY\")\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            textAlign: \"end\",\n            margin: \"auto 0\"\n          },\n          onClick: () => {\n            console.log(val);\n            onDeleteVisit(val.id);\n          },\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: \"/trash-2.svg\"\n          })\n        })]\n      });\n    });\n  };\n\n  const render = () => {\n    if (loading) {\n      return /*#__PURE__*/_jsx(Spinner, {});\n    } else {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [renderModalAdd(), /*#__PURE__*/_jsx(\"div\", {\n          className: styles.container,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: styles.wrapper,\n            children: [/*#__PURE__*/_jsx(Nav, {\n              backHref: \"/\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: styles.title_container,\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: styles.title,\n                children: \"Master Plan Visit\"\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: styles.main,\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: styles.input_container,\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    marginRight: \"5px\"\n                  },\n                  children: /*#__PURE__*/_jsx(\"input\", {\n                    className: styles.input,\n                    type: \"date\",\n                    value: moment(dateInput).format(\"YYYY-MM-DD\"),\n                    onChange: e => {\n                      setDateInput(moment(e.target.value));\n                    },\n                    min: moment().format(\"YYYY-MM-DD\")\n                  })\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    marginLeft: \"5px\"\n                  },\n                  children: /*#__PURE__*/_jsx(Button, {\n                    onClick: () => {\n                      setModal(true);\n                    },\n                    text: \"Add\"\n                  })\n                })]\n              }), /*#__PURE__*/_jsxs(Card, {\n                style: {\n                  marginTop: \"22px\",\n                  borderRadius: \"6px\"\n                },\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  style: {\n                    padding: \"10px\",\n                    fontSize: \"21px\",\n                    textAlign: \"center\"\n                  },\n                  children: \"List Master Plan\"\n                }), renderMasterPlanList()]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                style: {\n                  marginBottom: \"100px\"\n                }\n              })]\n            })]\n          })\n        })]\n      });\n    }\n  };\n\n  return render();\n}","map":null,"metadata":{},"sourceType":"module"}